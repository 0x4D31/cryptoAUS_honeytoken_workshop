<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Honeytoken Workshop</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/simple.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-background-color="#2A281F" data-menu-title="Cover">
				<h3>Detect When You Get Pwned Using</h3>
				<h1>Honeytokens</h1>
				</br>
					<p>
						<small><font color="#A9A8A7">By Adel Karimi / <a href="https://twitter.com/0x4d31">@0x4D31</a></font></small>
					</p>
				</section>
				<section data-menu-title="About me">
				<h2>About me</h2>
					<ul>
						<li>Adel "0x4D31" Karimi</li>
							<ul>
								<li><a href="https://www.honeynet.org">Honeynet Project</a> member & ex-chapter lead</li>
								<li><a href="https://trapbits.github.io">Trapbits</a> honeypot community, Founder</li>
							</ul>
							<img src="images/0x4d31.jpg" height="200">
					</ul>
				</section>
				<section data-menu-title="Agenda">
					<h2>Agenda</h2>
						<h3>An Introduction to <a href="https://github.com/paralax/awesome-honeypots">Honey{*}</a></h3>
						<h3>Honeytoken Workshop</h3>
				</section>
				<section data-background-color="#260339" data-menu-title="Honeypot section">
					<h1>Honeypots</h1>
				</section>
				<section>
					<section data-menu-title="Honeypot I">
						<h2>A resource whose value lies in being probed, attacked, or compromised!</h2>
						<p align="right"><i>- Lance Spitzner</i></p>
					</section>
					<section data-menu-title="II">
						<h2>No honey{*} has any <font color="#DF5100">authorized use</font></h2>
					</section>
					<section data-menu-title="III">
						<h3><font color="#DF5100">ANY</font> interaction with honeypot indicates malicious or unauthorized activity!<h3>
						<img src="images/0x4d31-honeypot.png" height="400">
					</section>
				</section>
				<section data-background-color="#053250" data-menu-title="Honeytoken section">
					<h1>Honeytokens</h1>
					<h3><a href="https://www.symantec.com/connect/articles/honeytokens-other-honeypot">The Other Honeypot</a></h3>
				</section>
				<section>
					<section data-menu-title="Honeytoken I">
						<h2>A honeypot that is not a computer!</h2>
						<h3>Honeytokens come in many different forms...</h3>
					</section>
					<section data-menu-title="II">
					    <h2>- Extremely flexible</h2>
						<h2>- Can be adapted to any environment</h2>
					</section>
					<section data-menu-title="III">
						<h2>A Honeytoken can be a...</h2>
						<ul>
							<li>Beacon document</li>
							<li>Fake credentials/accounts</li>
							<li>Database record</li>
							<li>URL or HTTP endpoint</li>
							<li>Fake file</li>
							<li>DNS record</li>
							<li>QR code!</li>
							<li>Anything you can think of!</li>
						</ul>
					</section>
					<section data-menu-title="IV">
						<h3>What about decoy mobile applications?</h3>
						<img src="images/decoy-apps.png" height="300">
						<small><i>- "Using Decoys to Identify Mobile Device Attackers", RSA Conference 2015</i></small>
						<h4><a href="https://github.com/thinkst/secretkeeper">Secret Keeper</a></h4>
					</section>
				</section>
				<section>
					<section data-menu-title="Use cases I">
						<h2>Post breach detection</h2>
						<h3>Depending on <font color="#DF5100">where/how</font> you implement honeytokens, you may detect ...</h3>
					</section>
					<section data-menu-title="II">
						<h2>Human attackers / intruders</h2>
						<h2>Malicious insiders</h2>
						<h2>Content scrapers or Bad bots</h2>
					</section>
					<section data-menu-title="III">
						<h2>And even your snooping partner! &#x1F61C;</h2>
						<img src="images/spy.gif" height="300">
					</section>
					<section data-menu-title="IV">
						<h2>Lure the attackers into revealing themselves</h2>
						<h4>...</h4>
					</section>
				</section>
				<section>
					<section data-menu-title="Post-compromise activities">
						<h2>Post-compromise activities</h2>
						<p><a href="https://attack.mitre.org/wiki/Main_Page">MITRE ATT&CK</a></p>
						<img src="images/MITRE_attack_tactics.png" height="200">
					</section>
					<section data-menu-title="Linux ATT&CK matrix">
						<h4>A part of Linux ATT&CK matrix</h4>
						<img src="images/att&ck-linux.png" height="500">
					</section>
					<section data-menu-title="Windows ATT&CK matrix">
						<h4>A part of Windows ATT&CK matrix</h4>
						<img src="images/att&ck-windows.png" height="600">
					</section>
				</section>
				<section data-background-color="#117864" data-menu-title="Honeytokening section">
					<h1>{Honey}tokening!</h1>
				</section>
				<section>
					<section data-menu-title="Files">
						<h1>Files!</h1>
					</section>
					<section data-menu-title="Documents">
						<h2><font color="#DF5100">Documents</font> with false information or decptive content</h2>
						<h3><font color="#117864">Purpose:</font> point attackers to traps/honey{*}</h3>
						<small>- Generating deceptive content {Google Ben Whitham + honey file}</small>
					</section>
					<section data-menu-title="Monitored files">
						<h2>Fake <font color="#DF5100">monitored files</font>:</h2>
						<h2>file access auditing</h2>
						<h3><font color="#117864">Purpose:</font> alert when accessed</h3>
					</section>
					<section data-menu-title="Beacon files">
						<h2><font color="#DF5100">Beacon files</font> such as token'd</h2>
						<h2>DOC or XLS files</h2>
						<h3><font color="#117864">Purpose:</font> phone home when opened!</h3>
					</section>
				</section>
				<section>
					<section data-menu-title="Credentials">
						<h1>Credentials!</h1>
					</section>
					<section data-menu-title="I">
						<h3><a href="https://isc.sans.edu/forums/diary/Detecting+Mimikatz+Use+On+Your+Network/19311/">Honey hash</a>: fake credentials in memory</h3>
						<h4>Pass-the-hash attack</h4>
					</section>
					<section data-menu-title="II">
						<h3>Fake API access tokens, e.g. AWS Access Keys</h3>
						<h3>Fake credentials in:</h3>
						<ul>
							<li>Password managers e.g. Web browser, KeePass</li>
							<li>Log and configuration files</li>
							<li>Documents e.g. instructions for remote access</li>
							<li>Email, Messengers, etc.</li>
						</ul>
					</section>

				</section>
				<section data-menu-title="URL tokens">
						<h1>URL {honey}token</h1>
						<h2><font color="#117864">Web bug</font></h2>
				</section>	
				<section data-menu-title="Network tokens">
					<h1>Network tokens</h1>
					<h3>Hosts file, ARP table, Open connections</h3>
					<h3><a href="http://www.beeswarm-ids.org/">Beeswarm</a> active IDS</h3>
				</section>
				<section data-background-color="#7C0124" data-menu-title="Workshop section">
					<h1>Workshop</h1>
					<h5>Honeytoken {Creation | Placement | Detection}</h5>
				</section>
				<section>
					<section data-background-color="#EBF5FB" data-menu-title="Honeyλ I">
						<h2>A Serverless Trap!</h2>
						<img src="https://github.com/0x4D31/honeyLambda/raw/master/docs/honeyLambda-sm.png" height="100">
						<h4>Create & monitor fake HTTP endpoints (ie. URL honeytokens) automatically</h4>
					</section>
					<section data-background-color="#EBF5FB" data-menu-title="II">
						<h2>Features</h2>
						<p class="fragment">Remote config: Amazon S3</p>
						<p class="fragment">Customize the HTTP response for each token</p>
						<p class="fragment">Threat Intelligence report (Source IP lookup)</p>
						<p class="fragment">Based on Serverless framework</p>
						<p class="fragment">--> pay-what-you-use</p>
						<p class="fragment"><b>TODO:</b> SSL client fingerprint, de-anonymization, automatic decoy generation</p>

					</section>
					<section data-background-color="#EBF5FB"  data-menu-title="III">
						<p>Slack, Email and SMS alerts</p>
						<img src="images/sms-alert.png" width="600">
					</section>
					<section data-background-color="#EBF5FB"  data-menu-title="IV">
						<img src="images/slack-alert.png" height="650">
					</section>
					<section data-background-color="#EBF5FB"  data-menu-title="Honeyλ Setup">
						<h2>Setup & Deploy</h2>
						<small>https://gist.github.com/0x4D31/093653b52f3e9e05e48a61701ca6de99</a></small>
						<h4><a href="https://zu4tj7nrqc.execute-api.us-east-1.amazonaws.com/dev/25c5feeaf1454ad4b489d3d0e18fec52/index?t=html">{Test}</a></h4>
						<h4><a href="https://www.mailinator.com/v2/inbox.jsp?zone=public&query=25c5feeaf1454ad4b489d3d0e18fec52.honeylambda">Email alert</a></h4>
					</section>
					<section data-background-color="#EBF5FB"  data-menu-title="honeyλ Config">
						<h2>HoneyLambda Config</h2>
						<pre><code>
{
	"default-http-response": {
		"content-type": "text/html",
		"body": "static/poc.html"
	},
	"traps": {
		"/examplec26b4d5e2c1e713/index14": {
			"t=email": {
				"note": "tracking pixel in email",
				"http-response": {
					"content-type": "image/png",
					"body": "static/pixel.png"
				}
			},
			"t=doc": {
				"note": "beacon pixel embedded in doc",
				"http-response": {
					"content-type": "image/png",
					"body": "static/pixel.png"
				}
			},
			"t=html": {
				"note": "secret link"
			}
		}
	},
	"alert": {
		"slack": {
			"enabled": "false",
			"webhook-url": ""
		},
		"email": {
			"enabled": "true",
			"to_email": "example.honeylambda14@mailinator.com",
			"smtp_server": "smtp.gmail.com",
			"smtp_port": 465,
			"smtp_user": "example@gmail.com",
			"smtp_password": "examplepassword"
		},
		"sms": {
			"enabled": "false",
			"to_number": "",
			"from_number": "",
			"twilio_account_sid": "",
			"twilio_auth_token": ""
		}
	},
	"threat-intel-lookup": {
		"enabled": "false",
		"cymon2-user": "",
		"cymon2-pass": ""
	}
}
						</code></pre>
					</section>
				</section>
				<section>
					<section data-background-color="#EAFAF1" data-menu-title="Honeybits I">
							<h1>Honeybits</h1>
					</section>
					<section>
						<h4>A simple tool designed to enhance the effectiveness of your traps by spreading breadcrumbs & honeytokens across your production servers and workstations to lure the attacker toward your honeypots</h4>
						<img src="images/honeybits.png" height="400">
					</section>
					<section data-background-color="#EAFAF1"  data-menu-title="Honeybits Config">
						<h2>Honeybits Config</h2>
						<pre><code>
path:
  bashhistory: /home/test/.bash_history
  awsconf: /home/test/.aws/config
  awscred: /home/test/.aws/credentials
  hosts: /etc/hosts

randomline:
  bashhistory: true
  confile: false

honeypot: 
  addr: 192.168.1.66


# Fake files
honeyfile:
  enabled: true
  monitor: none # Options: go-audit, auditd, none
  goaudit-conf: /etc/go-audit.yaml # Only if you use go-audit
  traps:
    # Format: - file_path:content_type:template
    ##  content_type: rdpconn, txtemail, 
    ##  template: config (read from config file: contentgen.xxx.template), template file path (/tmp/sampletemplate.txt)
    - /tmp/test.rdp:rdpconn:config
    - /tmp/email.txt:txtemail:template/txtemail

# Content generator for honeyfiles or file honeybits
contentgen:
  rdpconn:
    user: administrator
    pass: 12345
    domain: example.com
    template: "screen mode id:i:2\ndesktopwidth:i:1024\ndesktopheight:i:768\nuse multimon:i:1\nsession bpp:i:24\nfull address:s:%s\ncompression:i:1\naudiomode:i:2\nusername:s:%s\ndomain:s:%s\nauthentication level:i:0\nclear password:s:%s\ndisable wallpaper:i:0\ndisable full window drag:i:0\ndisable menu anims:i:0\ndisable themes:i:0\nalternate shell:s:\nshell working directory:s:\nauthentication level:i:2\nconnect to console:i:0\ngatewayusagemethod:i:0\ndisable cursor setting:i:0\nallow font smoothing:i:1\nallow desktop composition:i:1\nredirectprinters:i:0\nprompt for credentials on client:i:1\nuse redirection server name:i:0"
    # server: 192.168.1.66 # Default is 'honeypot addr'

  txtemail:
    user: dave
    pass: 12345
    # template: "From: Adel 0x <adel@example.com>\nSubject: Re: Monitoring system\nDate: March 22, 2017 at 21:59:15 GMT+11\nTo: Dave Cohen <dave.cohen@example.com>\nCc: security <security@example.com>\n\nHi,\n\nAh, sorry I forgot to send you the new address: http://%s\nI also reset your password (user: %s) to the default pass: %s\n\nPlease set the MFA (multi-factor authentication) ASAP.\n\nCheers,\nAdel\n\nOn 22 Mar 2017, at 9:57 pm, Dave Cohen <dave.cohen@example.com> wrote:\n\nHi Adel,\n\nI just wanted to login to the Monitoring system, but I get 404 error. Could you please have a look at it?\n\nThanks\nDave\n\nThe information contained in this email and any attachments is confidential and/or privileged. This email and any attachments are intended to be read only by the person named above. If the reader of this email, and any attachments, is not the intended recipient, you are hereby notified that any review, dissemination or copying of this email and any attachments is prohibited. If you have received this email and any attachments in error, please notify the sender by email or telephone and delete it from your email client."
    # server: 192.168.1.66 # Default is 'honeypot addr'
    

honeybits:

  # Fake records in config files
  awsconf:
    enabled: false
    profile: devsecops
    region: us-east-1
    accesskeyid: AKIAIOSFODNN7EXAMPLE
    secretaccesskey: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

  hostsconf:
    enabled: false
    # ip: 192.168.1.66 # Default is 'honeypot addr'
    name: mysql-srv

  # Fake records in bash_history
  ssh:
    enabled: false
    # server: 192.168.1.66 # Default is 'honeypot.addr'
    port: 2222
    user: root
    sshpass: false
    pass: 123456

  wget:
    enabled: false
    url: http://192.168.1.66:8080/backup.zip

  ftp:
    enabled: false
    # server: 192.168.1.66 # Default is 'honeypot.addr'
    port: 2121
    user: backup
    pass: b123

  rsync:
    enabled: false
    # server: 192.168.1.66 # Default is 'honeypot.addr'
    port: 2222
    user: root
    remotepath: /var/db/backup.tar.gz
    localpath: /tmp/backup.tar.gz
    sshpass: false
    pass: 12345

  scp:
    enabled: false
    # server: 192.168.1.66 # Default is 'honeypot.addr'
    port: 2222
    user: root
    remotepath: /var/db/backup.tar.gz
    localpath: /tmp/backup.tar.gz

  mysql:
    enabled: false
    # server: 192.168.1.66 # Default is 'honeypot.addr'
    port: 3306
    user: dbadmin
    pass: 12345
    command: show databases
    # dbname: clients

  aws:
    enabled: false
    profile: devops
    region: us-east-2
    command: ec2 describe-instances
    accesskeyid: AKIAIOSFODNN7EXAMPLE
    secretaccesskey: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# custom honeybits in bash_history
  custom:
    - telnet 192.168.1.66 25
    - nano /tmp/backup/credentials.txt
						</code></pre>
					</section>
				</section>
				<section data-background-color="#FEF9E7" data-menu-title="Canarytokens I">
						<h1>Canarytokens</h1>
				</section>
				<section>
					<h2>References</h2>
					<ul><small>
						<li>http://blog.thinkst.com/p/canarytokensorg-quick-free-detection.html</li>
						<li>https://www.topspinsec.com/blog/busting-honeypot-really-way-attackers-detect-deception</li>
						<li>https://github.com/0x4D31/honeyLambda</li>
						<li>https://github.com/0x4D31/honeybits</li>
						<li>https://github.com/0x4D31/honeybits-win</li>
						<li>https://github.com/thinkst/canarytokens-docker</li>
					</small></ul>
				</section>
				<section>
					<img src="images/slide.jpg">
					<p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				menu: {
					side: 'left',
					numbers: false,
				
					// Note: that a section data-menu-title attribute or an element
					// with a menu-title class will take precedence over this option
					titleSelector: 'h1, h2, h3, h4, h5, h6',
				
					// Hide slides from the menu that do not have a title.
					// Set to 'true' to only list slides with titles.
					hideMissingTitles: false,
				
					// Add markers to the slide titles to indicate the 
					// progress through the presentation
					markers: false,
				
					// Specify custom panels to be included in the menu, by
					// providing an array of objects with 'title', 'icon'
					// properties, and either a 'src' or 'content' property.
					custom: false,
				
					// Specifies the themes that will be available in the themes
					// menu panel. Set to 'false' to hide themes panel.
					themes: false,

					// Specifies if the transitions menu panel will be shown.
					transitions: true,

					// Adds a menu button to the slides to open the menu panel.
					// Set to 'false' to hide the button.
					openButton: true,

					// If 'true' allows the slide number in the presentation to
					// open the menu panel. The reveal.js slideNumber option must 
					// be displayed for this to take effect
					openSlideNumber: false,

					// If true allows the user to open and navigate the menu using
					// the keyboard. Standard keyboard interaction with reveal
					// will be disabled while the menu is open.
					keyboard: true,

					// Normally the menu will close on user actions such as
					// selecting a menu item, or clicking the presentation area.
					// If 'true', the sticky option will leave the menu open
					// until it is explicitly closed, that is, using the close
					// button or pressing the ESC or m key (when the keyboard 
					// interaction option is enabled).
					sticky: false,

					// If 'true' standard menu items will be automatically opened
					// when navigating using the keyboard. Note: this only takes 
					// effect when both the 'keyboard' and 'sticky' options are enabled.
					autoOpen: true
				},
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'bower_components/reveal.js-menu/menu.js' }
				]
			});
		</script>
		<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
	</body>
</html>
